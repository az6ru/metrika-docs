# История изменений | API Яндекс Метрики

Применение

## В этой статье:

  1. [API импорта данных](index.md)
  2. Measurement Protocol
  3. Использование Measurement Protocol

# Использование Measurement Protocol

Measurement Protocol — API для отправки данных о взаимодействиях пользователей напрямую на сервера Метрики через HTTP-запросы. Он расширяет возможности стандартного веб-счетчика, позволяя передавать дополнительные данные о визитах и действиях пользователей.

Примечание

Measurement Protocol рекомендуется использовать в дополнение к автоматическому сбору данных с веб-счетчика Метрики, а не вместо него.

## [](ru/data-import/measurement-about#use)Применение

#### [](ru/data-import/measurement-about#obuedinenie-dannyh)Объединение данных

Дополнение данных счетчика Метрики информацией о взаимодействиях, которые нельзя зафиксировать через веб-счетчик (например, данные с серверной стороны).

#### [](ru/data-import/measurement-about#otpravka-servernyh-dannyh)Отправка серверных данных

Передача данных с серверной стороны, когда клиентский сбор ограничен (например, из-за блокировщиков рекламы).

#### [](ru/data-import/measurement-about#peredacha-dannyh-elektronnoj-kommercii)Передача данных электронной коммерции

Прямая отправка данных о событиях электронной коммерции (покупки, корзины), если клиентский сбор невозможен.

Данные, отправляемые через API:

  * Посещения страниц
  * Javascript-события
  * События электронной коммерции
  * Параметры визитов

## [](ru/data-import/measurement-about#restrictions)Ограничения

#### [](ru/data-import/measurement-about#sozdanie-novyh-vizitov-c-pomoshyu-otkryvayushego-sobytiya)Создание новых визитов c помощью открывающего события `pageview`

Для создания новых визитов через Measurement Protocol необходимо отправлять запрос с типом взаимодействия `pageview`. Если вы отправляете события (например, события электронной коммерции или конверсии по JavaScript-целям), но они не могут быть привязаны к существующему визиту (из-за истечения 12 часов с момента его завершения или отсутствия визитов с переданным `ClientID`), данные не будут записаны. Чтобы избежать этого, сначала отправьте `pageview` для создания нового визита, а затем добавьте к нему нужные события.

#### [](ru/data-import/measurement-about#ogranichenie-po-vremeni-na-dopolnenie-vizitov)Ограничение по времени на дополнение визитов

Дополнять визиты можно только в течение 12 часов после их завершения, отправив для событий время, попадающее в тайм-аут визита, указанное в настройках счетчика. Если требуется передать данные для более старых визитов, используйте передачу офлайн-данных. Единственный способ записать данные через Measurement Protocol для пользователей, чьи визиты завершились более 12 часов назад, — это создать новый визит с нужным `ClientID` и добавить в него необходимые события, которые будут связаны с этим пользователем.

![alt](docs-assets/dev-metrika/rev/r16873860/_images/graph1-ru.png)

#### [](ru/data-import/measurement-about#dlya-obogasheniya-istorii)Постепенная доступность `ClientID` для обогащения истории

После включения опции Measurement Protocol Метрика начинает постепенно запоминать по `ClientID` историю пользователей, посещавших сайт, для возможности дальнейшего обогащения их истории новыми визитами через Measurement Protocol. Этот процесс происходит постепенно: сначала доступны `ClientID` за один день после включения фичи, затем за два, три и так далее, пока не будет достигнут 21 день. После этого самые старые данные удаляются, и сохраняется актуальная информация о `ClientID` за последний 21 день. Если визит пользователя произошел более 21 дня назад, невозможно продолжить его историю — будет создан новый пользователь с новым визитом.

![alt](docs-assets/dev-metrika/rev/r16873860/_images/graph2-ru.png)

## [](ru/data-import/measurement-about#config)Настройка передачи данных

  1. Активируйте Measurement Protocol в настройках.

Включите опцию в интерфейсе или API Метрики, получите авторизационный токен. [Подробнее](manage-protocol.md) про управление опцией и токенами через API.

  2. Сохраните `ClientID`.

Сохраните идентификатор `ClientID` на своем сервере для последующей отправки данных.

  3. Отправьте запрос.

Отправьте POST- или GET-запрос на `https://mc.yandex.../collect`.md с параметрами и токеном. [Подробнее](measurement-upload.md) про загрузку данных.

### Была ли статья полезна?

ДаНет

Предыдущая

[Список загрузок параметров](../management/openapi/user_params/findall.md)

Следующая

[Управление опцией и токенами](manage-protocol.md)