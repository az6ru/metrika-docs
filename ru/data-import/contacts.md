# История изменений | API Яндекс Метрики

Как передавать данные о клиентах и заказах из CRM

## В этой статье:

  1. [API импорта данных](index.md)
  2. Импорт данных о клиентах и заказах из CRM
  3. Передача данных из CRM

# Как передавать данные о клиентах и заказах из CRM

Вы можете дополнять статистику вашего сайта данными о клиентах и заказах из вашей CRM. Эта информация помогает:

Построить сквозную аналитику

Передавая в Метрику реальные продажи или этапы (статусы) ваших сделок из CRM вы сможете связывать их с онлайн-историей пользователей на сайте, получив анализ полной воронки продаж.

Оптимизировать рекламу в Директ

Создавайте цели для подтвержденных действий пользователей или статусов сделок из CRM и используйте их в оптимизации рекламы на выкупленные заказы/подписанные договоры/получение оплаты после заявки на сайте и т. д.

Формировать сегменты

Создавайте сегменты пользователей на основе офлайн-данных, включая технологию поиска похожих пользователей (look-alike). В сегмент можно включить и тех клиентов, кто не посещал сайт перед покупкой.

Улучшать точность данных

Минимизируйте расхождения между данными Метрики и информацией из вашей CRM-системы или отдела продаж.

Классифицировать заявки

Не все заполнения форм или заказы на сайте приводят к оплатам. Передавайте данные по «хорошим» заявкам, чтобы понимать какие каналы продаж наиболее эффективны.

Построить ROPO-отчеты

При наличии офлайн-точек вы можете передавать информацию о покупках в этих точках, чтобы увидеть влияние онлайна на офлайн-продажи.

Как передавать данные:

Примечание

Данные появятся в отчетах Метрики в течение двух часов после их загрузки.

## [](ru/data-import/contacts#contacts_data)Какие данные можно передавать в Метрику

Вы можете передавать:

**Информацию о клиентах**

  * id клиентов в вашей CRM;
  * название;
  * произвольные дополнительные параметры;
  * идентификаторы, по которым Метрика сможет найти их визиты на счетчике ([ClientId](https://yandex.../support/metrica/general/clientid-userid.md), `emails`, `phones`).

В дальнейшем эта информация позволит строить сегменты на основе данных о клиентах из вашей CRM.

**Заказы (сделки)**

  * id заказов в вашей CRM;
  * id клиента, который совершил заказ;
  * время заказа;
  * его статус и доход, себестоимость, валюта.

Дополнительно можно отправить товары (услуги) в заказе. Если Метрика обнаружит на вашем счетчике визит клиента, связанный с переданным заказом, то, в зависимости от переданного статуса заказа, в таком визите будут достигнуты цели.

Кроме этого, можно будет создать сегменты на клиентов с заказами в определенном статусе, большими тратами, частыми заказами и т.д.

## [](ru/data-import/contacts#contacts_formats)Форматы отправки данных

Отправить данные о клиентах и заказах из CRM можно с помощью:

Оба формата поддерживают атрибутирование конверсий с визитами по номеру телефона, адресу электронной почты посетителей или хешу от этих данных.

После успешной загрузки:

  * Будут созданы цели **CRM: Заказ создан** и **CRM: Заказ оплачен**. Вы сможете строить по ним отчеты в Метрике и Директе, а также использовать в оптимизации рекламных кампаний Директа наряду с обычными целями **JavaScript-событие** присланных в статусе заказа.
  * С помощью данных о клиентах вы сможете сегментировать статистику в большинстве отчетов Метрики, а также использовать данные для таргетирования рекламной кампании в Директе.
  * Вы сможете использовать данные о любых переданных целях заказов в отчетах [Сквозной аналитики](https://yandex.../support/metrica/analytics/intro.md) отметив эти цели избранными.

Отправка подробных данных позволяет отправлять вместе с заказами информацию о [списках товаров или услуг](../management/openapi/schema/createproducts.md), по которым был совершен заказ, а также произвольные [атрибуты](../management/openapi/schema/createattributes.md) по вашим клиентам.. На основе этой информации вы сможете создавать сегменты аудитории для таргетирования в рекламных кампаниях.

## [](ru/data-import/contacts#contacts_visits)Как Метрика привязывает данные из CRM к визитам

Когда вы отправляете в Метрику информацию о заказе (сделке) из вашей CRM, Метрика привязывает этот заказ к ближайшему по времени визиту посетителя вашего сайта. Посетитель определяется исходя из тех данных, которые вы отправили в качестве идентификаторов клиента, совершившего заказ ([ClientId](https://yandex.../support/metrica/general/clientid-userid.md), `emails`, `phones`).

Заказы из CRM могут быть привязаны к визитам и посетителям в пределах 21 дня от текущей даты. После успешной привязки заказа, у вас есть возможность вносить изменения в заказ в течение следующих 111 дней с начала визита (менять его статусы, сумму, товары). Подробнее про окно привязки — в разделе [Учет офлайн-конверсий](https://yandex.../support/metrica/data/offline-params.md).

Привязка заказа к визитам является ключевым аспектом для построения сквозной аналитики. Она позволяет не только связать с посетителями сайта заказ и его статусы, купленные товары или услуги, но и цели, выполняемые вместе со статусами привязанного заказа.

Отсутствие привязки заказа к визиту означает, что заказ будет отображаться только в отчете [Посетители и клиенты](https://yandex.../support/metrica/general/people.md) и не будет включен в другие отчеты Метрики. Более того, цели, ассоциированные со статусами заказа, не будут переданы в Директ, если визиты связаны с этим рекламным источником.

Для обеспечения точности отчетов и эффективности маркетинговых стратегий, убедитесь, что все заказы корректно привяжутся к соответствующим визитам:

  1. Проверьте корректность переданных в Метрику идентификаторов: [ClientId](https://yandex.../support/metrica/general/clientid-userid.md), номеров телефонов и адресов e-mail ваших клиентов.

  2. Отправляйте заказы в пределах 21 дня от текущей даты. Если вы передаете заказ, который был совершен 22 дня назад, — он не будет привязан к визитам пользователей (не относится к обновлению уже привязанных к визитам заказов).

  3. Используйте идентификатор [ClientId](https://yandex.../support/metrica/general/clientid-userid.md) для передачи заказов в Метрику — это увеличит вероятность корректной привязки заказов по сравнению с идентификаторами номеров телефонов или электронной почты. Рекомендуется передавать идентификатор [ClientId](https://yandex.../support/metrica/general/clientid-userid.md) при создании каждой сделки в вашей CRM-системе.

Примечание

Если вы не можете записать идентификатор [ClientId](https://yandex.../support/metrica/general/clientid-userid.md) (например, при покупке в офлайн-точке) или настроить его передачу в свою CRM, используйте технологию [Advanced Matching](https://yandex.../support/metrica/general/advanced-matching.md): включите опцию [Дополнительные настройки отслеживания](https://yandex.../support/metrica/general/counter-general.md) в настройках счетчика для более точной привязки заказов по e-mail и телефонам.

## [](ru/data-import/contacts#contacts_analyst)Анализ и управление статусами заказов из CRM

Заказы, привязанные Метрикой к визитам, дают возможность отслеживать эффективность трафика с помощью передачи статусов заказа. Для сегментации в отчетах Метрики доступны все 5 типов статуса заказа:

  * **Заказ создан** — идентификатор статуса по умолчанию `IN_PROGRESS` — при передаче этого типа статуса будет достигнута цель **CRM: Заказ создан**.
  * **Заказ оплачен** — идентификатор статуса по умолчанию `PAID` — при передаче этого типа статуса будет достигнута цель **CRM: Заказ оплачен**.
  * **Заказ отменен** — идентификатор статуса по умолчанию `CANCELLED` — при передаче этого типа статуса будет достигнута цель **CRM: Заказ отменен**.
  * **Спам-заказ** — идентификатор статуса по умолчанию `SPAM` — при передаче этого типа статуса будет достигнута цель **CRM: Спам заказ**.
  * **Заказ в другом статусе** — заказам присваивается тип статуса `OTHER`, если в качестве статуса вы отправляете идентификатор цели с типом JavaScript-событие, которую самостоятельно создали на счетчике.

В упрощенной передаче данных из CRM доступны 4 стандартных типа статуса для передачи: `IN_PROGRESS`, `PAID`, `SPAM` и `CANCELLED`, а также идентификаторы ваших JavaScript-целей.

Пример использования

Допустим, на вашем сайте клиент заполнил форму обратной связи. Вы фиксируете [ClientId](https://yandex.../support/metrica/general/clientid-userid.md) этого посетителя и отправляете его вместе с данными формы в вашу CRM.

Вот как может выглядеть жизненный цикл заказа и отслеживание связанных с ним целей:

  1. **Создание сделки**. Как только сделка создана в вашей CRM, отправьте в Метрику заказ со статусом `IN_PROGRESS` и номером сделки из CRM. В этот момент в визите пользователя на счетчике будет достигнута цель Заказ Создан.

  2. **Качественный лид**. После коммуникации с клиентом и подтверждения его заинтересованности, поменяйте в вашей CRM статус сделки на **Качественный лид**. Создайте для этого статуса цель с типом **JavaScript-событие** на счетчике с названием «Хорошие лиды» и идентификатором `good_lead`.

Отправьте в Метрику обновление по номеру заказа с новым статусом `good_lead` — в визите пользователя будут выполнены две цели: **Заказ Создан** и **Хорошие лиды**. Сам заказ при этом перейдет в тип статуса **Заказ в другом статусе**.

  3. **Оплата сделки**. После оплаты клиентом вашей услуги, в последнем обновлении заказа отправьте в Метрику статус заказа `PAID`, и в визите клиента выполнится цель **Заказ Оплачен**. Так в визите пользователя будут достигнуты 3 цели, которые вы сопоставили с вашими статусами из CRM, а сам заказ перейдет в статус **Заказ оплачен**.

Таким образом, за время взаимодействия с клиентом в его визите будут выполнены три цели, которые соответствуют изменениям статуса заказа в вашей CRM-системе. Эта последовательность действий позволяет вам точно отслеживать прогресс взаимодействия с клиентами и эффективность ваших маркетинговых усилий.

В полной передаче данных вы можете реализовать сложную логику выполнения целей, связанных со статусами заказов в CRM.

Пример использования

Предположим, вы представляете сеть стоматологических клиник с несколькими филиалами. C помощью полной передачи данных из CRM вы настроили синхронизацию ваших статусов из CRM со статусами заказов в Метрике.

Клиент оставил заявку на сайте, вы перезвонили ему и записали в филиал №1 на услугу профессиональной чистки зубов. Позже клиент перезвонил вам и отменил запись. После этого он сделал еще один звонок, в котором записался в филиал №2 на удаление зуба, пришел и оплатил услуги.

В CRM путь сделки по статусам этого клиента будет выглядеть так:

_**Новый Лид — Запись в филиал №1 — Отмена Записи — Запись в филиал №2 — Оплата Услуг**_

В Метрике вы создали статусы заказов с такими же названиями и заложили следующую логику:

  1. **Новый лид** — статус заказа `new_lead` — будет достигнута цель **Заказ Создан** , тип статуса заказа — **В работе**.

  2. **Запись в филиал №1** — статус заказа `zapis1` — будет достигнута JavaScript-цель счетчика Метрики **Записаны в 1** филиал c идентификатором `zapis1` и дополнительно будет достигнута JavaScript-цель счетчика Метрики **Все записи** c идентификатором `vse_zapisi`, тип статуса заказа — **Заказ в другом статусе**.

  3. **Отмена записи** — статус заказа `CANCELLED` — цели не будут достигнуты, сам заказ будет с типом статуса **Отмененные**.

  4. **Запись в филиал №2** — статус заказа `zapis2` — будет достигнута JavaScript-цель счетчика Метрики **Записаны во 2 филиал** c идентификатором `zapis2` и дополнительно будет достигнута JavaScript-цель счетчика Метрики **Все записи** c идентификатором `vse_zapisi`, тип статуса заказа — **Заказ в другом статусе**.

  5. **Оплата услуг** — статус заказа `paid_in_filial2` — будет достигнута цель **Заказ оплачен** и дополнительно будет достигнута JavaScript-цель счетчика Метрики **Оплаты 2 филиала** с идентификатором `oplaty_2_filial`, тип статуса заказа — **Заказ оплачен**.

Во всех выполненных целях в качестве дохода будет передаваться прибыль по сделкам, указанным в CRM. Доход по целям можно использовать в Директе в стратегии [Максимум конверсий](https://yandex.../support/direct/strategies/average-cpa.md) с ограничением расходов по [Доле рекламных расходов](https://yandex.../support/direct/strategies/average-cpa.md).

### Была ли статья полезна?

ДаНет

Предыдущая

[Доступные значения TrafficSource и TrafficSourceDetail](../management/table-source.md)

Следующая

[Настройка упрощенной отправки данных](simple-orders-prep.md)